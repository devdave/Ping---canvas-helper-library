<!DOCTYPE html>
<html>
    <head>
        <title>Mapping/partitioning</title>
        <script src="./js/jquery.js"></script>
        <!--<script type="text/javascript" src="/js/jquery.jstree.js"></script>-->
        <script src="libs/ping.main.js"></script>
        <script src="libs/ping.shapes.js"></script>
        <script src="libs/ping.canvas.js"></script>
        <script src="libs/ping.intersection.js"></script>
        <script src="./quadtree.js"></script>
        <script src="./quadtree.util.js"></script>
    </head>
    <body>
        
        <canvas height="400" width="600" id="mapper"></canvas>
        <div class="statPanel" style="float:right">
            <label>Allow move<input type="checkbox" id="allowMove" checked></label>
            <br style="clear:both" />
            <ol id="wtf"></ol><br/>
            <label>Node list</label>
            <ul id="nodeList"></ul>
            
        </div>
        <script>
            
            function run(){
                
                var allowMovement = true;
                $("#allowMove").change(function(){
                    allowMovement = !allowMovement;
                    });
                var balls = [];
                for(var bMax = 0; bMax < 50; bMax++){
                    balls.push(ballFactory(600,400));                 
                }
                
                var stepPos = 9;
                ctx = ping.$C("mapper");
                map = QuadrantFactory(ctx, stepPos);
                
                function runLogic(){
                    var highX = 0, highY = 0;
                    ctx = ping.$C("mapper");
                    delete map;
                    map = QuadrantFactory(ctx, stepPos);
                    for(var i = 0; i < balls.length; i++){
                        //Add to the map
                        map.add(balls[i]);
                        if(allowMovement) {
                            balls[i].step();
                            balls[i] = RunBall(balls[i], map, allowMovement);
                        }
                    }    
                    if(allowMovement){
                    }
                    
                    ctx.beginPath();
                    ctx.clearAll();
                    for(var i = 0; i < balls.length; i++){
                        balls[i] = RenderBall(balls[i], map, ctx)
                    }
                    map.render(ctx);
                    ctx.closePath();                    
                }
                setInterval(runLogic, 25);
               
               
            };
        
            $(run);
        </script>
        
    </body>
</html>